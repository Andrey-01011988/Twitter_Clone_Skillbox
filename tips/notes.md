# Пояснения к файлу nginx.conf

Данный код представляет собой конфигурацию веб-сервера Nginx. Ниже приведено подробное описание каждой строки.

## Общая конфигурация

- **`user www-data;`**  
  Указывает, что процессы Nginx будут работать от имени пользователя `www-data`. Это стандартный пользователь для веб-серверов в большинстве дистрибутивов Linux.

- **`worker_processes auto;`**  
  Устанавливает количество рабочих процессов. Значение `auto` позволяет Nginx автоматически определить оптимальное количество процессов в зависимости от количества доступных CPU.

- **`error_log /var/log/nginx/error.log notice;`**  
  Указывает путь к файлу журнала ошибок и уровень логирования. В данном случае ошибки будут записываться в файл `/var/log/nginx/error.log` с уровнем `notice`, что означает, что будут записываться уведомления о различных событиях, включая предупреждения и ошибки.

- **`pid /var/run/nginx.pid;`**  
  Указывает путь к файлу, в котором будет храниться идентификатор процесса (PID) главного процесса Nginx. Этот файл используется для управления процессами Nginx.

## Блок событий

- **`events {`**  
  Начало блока конфигурации событий, который управляет обработкой соединений.

- **`worker_connections 1024;`**  
  Устанавливает максимальное количество соединений, которые каждый рабочий процесс может обрабатывать одновременно. В данном случае это значение равно 1024.

## Блок HTTP

- **`http {`**  
  Начало блока конфигурации HTTP, который определяет настройки для обработки HTTP-запросов.

- **`include /etc/nginx/mime.types;`**  
  Подключает файл с определениями MIME-типов, который позволяет серверу правильно обрабатывать различные типы файлов.

- **`default_type application/octet-stream;`**  
  Устанавливает тип контента по умолчанию для файлов, MIME-тип которых не определен в `mime.types`. Значение `application/octet-stream` указывает на бинарные данные.

- **`log_format main '$remote_addr - $remote_user [$time_local] "$request" ' ... ;`**  
  Определяет формат записи в журнал доступа. В данном случае он включает IP-адрес клиента, имя пользователя (если есть), время запроса, сам запрос, статус ответа, количество отправленных байт и информацию о реферере и пользовательском агенте.

- **`access_log /var/log/nginx/access.log main;`**  
  Указывает путь к файлу журнала доступа и использует формат `main`, который был определен ранее.

- **`sendfile on;`**  
  Включает использование функции `sendfile`, которая позволяет эффективно передавать файлы клиентам, минимизируя использование ресурсов CPU.

- **`keepalive_timeout 65;`**  
  Устанавливает время ожидания для поддержания соединения с клиентом. Если клиент не отправляет запрос в течение этого времени (65 секунд), соединение будет закрыто.

## Конфигурация сервера

- **`server {`**  
  Начало блока конфигурации сервера. Здесь определяются параметры для конкретного виртуального сервера.

- **`listen 80;`**  
  Указывает, что сервер будет слушать входящие соединения на порту 80 (стандартный порт для HTTP).

- **`root /app/static;`**  
  Устанавливает корневую директорию для статических файлов. В данном случае это `/app/static`.

### Локации

- **`location /api/ { ... }`**  
  Определяет настройки для запросов к URL, начинающимся с `/api/`.

    - **`proxy_pass http://api_server;`**  
      Перенаправляет запросы к указанному upstream-серверу с именем `api_server`.

    - **`proxy_set_header Host $host;`**  
      Передает заголовок `Host`, который содержит имя хоста из исходного запроса клиента.

    - **`proxy_set_header X-Real-IP $remote_addr;`**  
      Передает реальный IP-адрес клиента через заголовок `X-Real-IP`.

    - **`proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;`**  
      Передает цепочку IP-адресов клиентов через заголовок `X-Forwarded-For`, что полезно для определения оригинального IP клиента при использовании прокси-серверов.

- **`location / { ... }`**  
  Определяет настройки для всех остальных запросов (корневая директория).

    - **`try_files $uri $uri/ /index.html;`**  
      Проверяет наличие запрашиваемого файла или директории. Если файл не найден, возвращается `/index.html`, что полезно для одностраничных приложений (SPA).

    - **`autoindex on;`**  
      Включает автоматическую индексацию содержимого директорий, если запрашивается директория без указания конкретного файла. Это создает список файлов в директории.